ğŸ¯ Má»¥c tiÃªu BÃ i 6 (nÃ³i tháº³ng, dá»… nhá»›)

Sau bÃ i nÃ y báº¡n sáº½ hiá»ƒu táº­n gá»‘c:

VÃ¬ sao xoay mÃ n hÃ¬nh khÃ´ng máº¥t data

VÃ¬ sao observe() tá»± cháº¡y láº¡i

value vs postValue khÃ¡c nhau tháº¿ nÃ o

LiveData tá»± xá»­ lÃ½ lifecycle ra sao (khÃ´ng leak, khÃ´ng crash)

ğŸ§  TÆ° duy trÆ°á»›c khi code (ráº¥t quan trá»ng)

ğŸ‘‰ CÃ³ 2 thá»© KHÃC NHAU:

ViewModel sá»‘ng lÃ¢u (qua rotation)

Activity cháº¿t & táº¡o láº¡i

LiveData chÃ­nh lÃ  cÃ¢y cáº§u ná»‘i an toÃ n giá»¯a 2 thá»© nÃ y.

ğŸ§© SÆ¡ Ä‘á»“ tá»•ng quan BÃ i 6
1ï¸âƒ£ Test thá»±c táº¿: Xoay mÃ n hÃ¬nh cÃ³ chuyá»‡n gÃ¬ xáº£y ra?
Code hiá»‡n táº¡i (khÃ´ng Ä‘á»•i)
ViewModel
private val _message = MutableLiveData<String>()
val message: LiveData<String> = _message

fun greet(name: String) {
    _message.value = "Hello $name"
}

Activity
viewModel.message.observe(this) { message ->
    binding.tvResult.text = message
}

ğŸ§ª Ká»‹ch báº£n test

Má»Ÿ app

Nháº­p: Nam

Nháº¥n Greet â†’ hiá»‡n "Hello Nam"

Xoay mÃ n hÃ¬nh

ğŸ‘‰ â“ CÃ¢u há»i:
VÃ¬ sao text VáºªN cÃ²n?

2ï¸âƒ£ Chuyá»‡n gÃ¬ xáº£y ra khi xoay mÃ n hÃ¬nh? (bÃ³c tá»«ng bÆ°á»›c)
ğŸ”´ Activity

onDestroy()

object Activity cháº¿t tháº­t

ğŸŸ¢ ViewModel

KHÃ”NG bá»‹ destroy

váº«n náº±m trong ViewModelStore

ğŸ‘‰ ÄÃ¢y lÃ  lÃ½ do state khÃ´ng máº¥t

3ï¸âƒ£ Váº­y vÃ¬ sao UI hiá»‡n láº¡i text dÃ¹ Activity má»›i?
Giai Ä‘oáº¡n 1 â€“ Activity má»›i Ä‘Æ°á»£c táº¡o
viewModel.message.observe(this) { message ->
    binding.tvResult.text = message
}


ğŸ‘‰ Observer Ä‘Äƒng kÃ½ láº¡i

Giai Ä‘oáº¡n 2 â€“ LiveData pháº£n á»©ng

ğŸ“Œ QUY Táº®C VÃ€NG cá»§a LiveData:

Khi observer má»›i Ä‘Äƒng kÃ½,
náº¿u LiveData Ä‘Ã£ cÃ³ value,
â†’ gá»­i value NGAY Láº¬P Tá»¨C

ğŸ‘‰ LiveData tháº¥y:

value = "Hello Nam"

lifecycle = ACTIVE

â¡ï¸ Gá»i observe callback ngay

4ï¸âƒ£ Chá»‘t nÃ£o BÃ i 6 â€“ cÃ¢u cá»±c quan trá»ng

â— observe() khÃ´ng chá»‰ cháº¡y khi value thay Ä‘á»•i
â— mÃ  cÃ²n cháº¡y khi observer má»›i xuáº¥t hiá»‡n

ÄÃ¢y lÃ  lÃ½ do:

xoay mÃ n hÃ¬nh

back / resume

quay láº¡i app

ğŸ‘‰ UI luÃ´n sync Ä‘Ãºng state

5ï¸âƒ£ Lifecycle â€“ LiveData tá»± báº£o vá»‡ báº¡n tháº¿ nÃ o?
viewModel.message.observe(this) { ... }


this = LifecycleOwner

LiveData chá»‰ gá»i observer khi Activity á»Ÿ tráº¡ng thÃ¡i:

âœ… STARTED

âœ… RESUMED

âŒ KHÃ”NG gá»i khi:

STOPPED

DESTROYED

ğŸ‘‰ KhÃ´ng crash
ğŸ‘‰ KhÃ´ng memory leak
ğŸ‘‰ KhÃ´ng cáº§n remove observer thá»§ cÃ´ng

6ï¸âƒ£ value vs postValue (ráº¥t hay bá»‹ há»i)
value
_message.value = "Hello"


Cháº¡y MAIN THREAD

DÃ¹ng trong:

click

logic UI

postValue
_message.postValue("Hello")


DÃ¹ng khi BACKGROUND THREAD

VÃ­ dá»¥:

network

coroutine Dispatchers.IO

ğŸ“Œ Náº¿u gá»i value á»Ÿ background â†’ CRASH

7ï¸âƒ£ TÃ³m táº¯t LUá»’NG BÃ€I 6 (1 phÃºt nhá»›)
User click
â†’ ViewModel Ä‘á»•i state
â†’ LiveData giá»¯ value
â†’ Activity cháº¿t (rotation)
â†’ Activity má»›i observe
â†’ LiveData gá»­i láº¡i value
â†’ UI restore

ğŸ§  5 CÃ‚U GHI NHá»š (ráº¥t Ä‘Ã¡ng giÃ¡)

ViewModel khÃ´ng cháº¿t khi xoay

LiveData giá»¯ state

Observer má»›i â†’ nháº­n value cÅ©

LiveData chá»‰ gá»i khi lifecycle ACTIVE

value = main thread, postValue = background

â— Lá»–I TÆ¯ DUY HAY Gáº¶P (báº¡n trÃ¡nh Ä‘Æ°á»£c lÃ  hÆ¡n ngÆ°á»i)

âŒ â€œLiveData chá»‰ cháº¡y khi value Ä‘á»•iâ€
âœ… Sai â€“ observer má»›i cÅ©ng Ä‘Æ°á»£c gá»i

âŒ â€œActivity giá»¯ dataâ€
âœ… Sai â€“ ViewModel giá»¯ data