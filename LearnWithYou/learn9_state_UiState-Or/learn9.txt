ğŸ§  BÃ€I 9 â€“ Gom toÃ n bá»™ State vÃ o UiState

Má»¥c tiÃªu 1 cÃ¢u:
ğŸ‘‰ ViewModel chá»‰ phÃ¡t ra 1 state duy nháº¥t, UI chá»‰ viá»‡c nhÃ¬n state Ä‘Ã³ mÃ  váº½.

1ï¸âƒ£ Váº¥n Ä‘á» cá»§a cÃ¡c bÃ i trÆ°á»›c (ráº¥t thá»±c táº¿)

á» BÃ i 5 â†’ 8, báº¡n thÆ°á»ng tháº¥y ViewModel kiá»ƒu nÃ y:

class MainViewModel : ViewModel() {

    private val _message = MutableLiveData<String>()
    val message: LiveData<String> = _message

    private val _isLoading = MutableLiveData<Boolean>()
    val isLoading: LiveData<Boolean> = _isLoading

    private val _error = MutableLiveData<String?>()
    val error: LiveData<String?> = _error
}


ğŸ‘‰ NhÃ¬n thÃ¬ á»•n, nhÆ°ng cÃ³ 3 váº¥n Ä‘á» lá»›n:

âŒ Váº¥n Ä‘á» 1 â€“ UI pháº£i observe quÃ¡ nhiá»u thá»©
viewModel.message.observe(this) { ... }
viewModel.isLoading.observe(this) { ... }
viewModel.error.observe(this) { ... }


UI bá»‹ dÃ­nh logic ghÃ©p tráº¡ng thÃ¡i
â†’ ráº¥t giá»‘ng MVC cÅ©, chá»‰ khÃ¡c lÃ  dÃ¹ng LiveData

âŒ Váº¥n Ä‘á» 2 â€“ State cÃ³ thá»ƒ lá»‡ch nhau

isLoading = false

nhÆ°ng message chÆ°a set

hoáº·c error set trá»…

â›” UI cÃ³ thá»ƒ rÆ¡i vÃ o tráº¡ng thÃ¡i â€œná»­a vá»iâ€

âŒ Váº¥n Ä‘á» 3 â€“ Compose KHÃ”NG thÃ­ch kiá»ƒu nÃ y

Compose muá»‘n:

â 1 state â†’ 1 UI tree â

2ï¸âƒ£ TÆ° duy má»›i: UI = f(State)

Ghi nhá»› cÃ¢u nÃ y (ráº¥t quan trá»ng):

UI chá»‰ lÃ  káº¿t quáº£ cá»§a STATE


ğŸ‘‰ Váº­y thÃ¬:

Thay vÃ¬ nhiá»u LiveData

Ta táº¡o 1 object chá»©a toÃ n bá»™ state

3ï¸âƒ£ UiState lÃ  gÃ¬?

ğŸ‘‰ UiState = data class mÃ´ táº£ toÃ n bá»™ mÃ n hÃ¬nh

VÃ­ dá»¥ mÃ n hÃ¬nh cÃ³:

text hiá»ƒn thá»‹

loading

lá»—i

â¡ï¸ Ta gom láº¡i:

data class MainUiState(
    val message: String = "",
    val isLoading: Boolean = false,
    val error: String? = null
)


ğŸ“Œ Ráº¥t giá»‘ng model trong MVC,
nhÆ°ng khÃ¡c á»Ÿ chá»—:

âŒ UI khÃ´ng sá»­a state

âœ… ViewModel lÃ  chá»§ duy nháº¥t cá»§a state

4ï¸âƒ£ ViewModel sau khi dÃ¹ng UiState
ğŸ”¹ DÃ¹ng LiveData (Ä‘Ãºng nhá»‹p lá»™ trÃ¬nh)
class MainViewModel : ViewModel() {

    private val _uiState = MutableLiveData(MainUiState())
    val uiState: LiveData<MainUiState> = _uiState

    fun greet(name: String) {
        _uiState.value = _uiState.value?.copy(
            isLoading = true
        )

        val greeting = "Hello $name"

        _uiState.value = _uiState.value?.copy(
            message = greeting,
            isLoading = false,
            error = null
        )
    }
}


ğŸ§  TÆ° duy cá»‘t lÃµi á»Ÿ Ä‘Ã¢y:

KhÃ´ng set tá»«ng biáº¿n

LuÃ´n copy state cÅ© â†’ táº¡o state má»›i

5ï¸âƒ£ Activity (hoáº·c Fragment) lÃºc nÃ y Ráº¤T sáº¡ch
viewModel.uiState.observe(this) { state ->
    binding.tvResult.text = state.message
    binding.progressBar.isVisible = state.isLoading
    binding.tvError.text = state.error ?: ""
}


ğŸ‘‰ UI chá»‰ Ä‘á»c state, khÃ´ng suy luáº­n

6ï¸âƒ£ So sÃ¡nh TRÆ¯á»šC vs SAU (ráº¥t quan trá»ng)
TrÆ°á»›c	Sau
Nhiá»u LiveData	1 UiState
UI ghÃ©p logic	UI chá»‰ render
Dá»… lá»‡ch state	State luÃ´n Ä‘á»“ng bá»™
KhÃ³ lÃªn Compose	Chuáº©n Compose
7ï¸âƒ£ CÃ¢u há»i báº¡n cháº¯c cháº¯n sáº½ tháº¯c máº¯c
â“ UiState cÃ³ pháº£i MVC khÃ´ng?

ğŸ‘‰ Cáº£m giÃ¡c giá»‘ng, nhÆ°ng báº£n cháº¥t khÃ¡c

MVC	MVVM + UiState
View Ä‘á»c + sá»­a model	View chá»‰ Ä‘á»c
Logic ráº£i rÃ¡c	Logic táº­p trung ViewModel
Dá»… loáº¡n	State báº¥t biáº¿n
â“ Táº¡i sao pháº£i copy()?

VÃ¬:

State nÃªn immutable

KhÃ´ng ai sá»­a lung tung

Má»—i láº§n thay Ä‘á»•i = state má»›i â†’ UI render láº¡i

8ï¸âƒ£ Checklist Ä‘á»ƒ báº¡n tá»± kiá»ƒm tra Ä‘Ã£ hiá»ƒu chÆ°a

Báº¡n Ä‘Ã£ hiá»ƒu náº¿u:

âœ… Biáº¿t vÃ¬ sao khÃ´ng nÃªn nhiá»u LiveData

âœ… Hiá»ƒu UiState mÃ´ táº£ toÃ n bá»™ mÃ n hÃ¬nh

âœ… Hiá»ƒu UI chá»‰ render theo state

âœ… Tháº¥y rÃµ Ä‘Ã¢y lÃ  bÆ°á»›c Ä‘á»‡m cho Compose

9ï¸âƒ£ BÃ i táº­p NHáº¸ (ráº¥t nÃªn lÃ m)

ğŸ‘‰ Trong project hiá»‡n táº¡i:

Táº¡o MainUiState

Gá»™p:

message

loading

error

Sá»­a ViewModel chá»‰ cÃ²n 1 LiveData<UiState>

Activity chá»‰ observe uiState

â›” KhÃ´ng cáº§n backend
â›” KhÃ´ng cáº§n coroutine
â›” Chá»‰ tÆ° duy state
========================================================
1ï¸âƒ£ Váº¥n Ä‘á» khi cÃ³ nhiá»u LiveData / StateFlow rá»i ráº¡c

Giáº£ sá»­ ViewModel kiá»ƒu cÅ©:

val message: LiveData<String>
val isLoading: LiveData<Boolean>
val error: LiveData<String?>

âŒ Váº¥n Ä‘á» thá»±c sá»± KHÃ”NG pháº£i lÃ  â€œnhiá»u biáº¿nâ€

ğŸ‘‰ mÃ  lÃ  nhiá»u nguá»“n sá»± tháº­t

message tá»± Ä‘á»•i

loading tá»± Ä‘á»•i

error tá»± Ä‘á»•i
â›” khÃ´ng cÃ³ gÃ¬ Ä‘áº£m báº£o chÃºng Ä‘á»“ng bá»™ vá»›i nhau

ğŸ“Œ UI pháº£i tá»± â€œÄ‘oÃ¡nâ€:

if (!isLoading && error == null) {
   // hiá»ƒn thá»‹ message?
}


ğŸ‘‰ UI Ä‘ang suy luáº­n logic
â†’ Sai vai trÃ² cá»§a UI

2ï¸âƒ£ UiState lÃ  gÃ¬? (nÃ³i 1 cÃ¢u cho nhá»›)

UiState = áº£nh chá»¥p toÃ n bá»™ tráº¡ng thÃ¡i cá»§a mÃ n hÃ¬nh táº¡i 1 thá»i Ä‘iá»ƒm

VÃ­ dá»¥:

data class MainUiState(
    val message: String = "",
    val isLoading: Boolean = false,
    val error: String? = null
)


ğŸ“Œ KhÃ´ng pháº£i â€œ3 biáº¿nâ€
ğŸ“Œ MÃ  lÃ  1 tráº¡ng thÃ¡i hoÃ n chá»‰nh

â¡ï¸ Má»—i láº§n state Ä‘á»•i
â¡ï¸ LÃ  toÃ n bá»™ mÃ n hÃ¬nh Ä‘á»•i theo

3ï¸âƒ£ Single Source of Truth lÃ  gÃ¬?

ğŸ‘‰ ÄÃ¢y lÃ  linh há»“n cá»§a BÃ i 9

âŒ TrÆ°á»›c Ä‘Ã¢y
message   â†’ 1 nguá»“n
loading   â†’ 1 nguá»“n
error     â†’ 1 nguá»“n


UI khÃ´ng biáº¿t tin ai trÆ°á»›c

âœ… Sau khi dÃ¹ng UiState
MainUiState
   â”œâ”€ message
   â”œâ”€ isLoading
   â””â”€ error


ğŸ‘‰ CHá»ˆ CÃ“ 1 NGUá»’N DUY NHáº¤T

ğŸ“Œ Single Source of Truth =

Má»i thá»© UI cáº§n Ä‘á»u náº±m trong 1 object state

4ï¸âƒ£ â€œViewModel chá»‰ expose 1 stateâ€ nghÄ©a lÃ  gÃ¬?
âŒ KhÃ´ng cÃ²n tháº¿ nÃ y
val message: LiveData<String>
val isLoading: LiveData<Boolean>
val error: LiveData<String?>

âœ… MÃ  chá»‰ cÃ²n DUY NHáº¤T
val uiState: LiveData<MainUiState>


ğŸ“Œ ViewModel:

giá»¯ logic

cáº­p nháº­t state

phÃ¡t ra 1 luá»“ng state

ğŸ“Œ UI:

observe 1 thá»©

render theo state

khÃ´ng Ä‘oÃ¡n, khÃ´ng ghÃ©p

5ï¸âƒ£ CÃ¢u chá»‘t nÃ£o (báº¡n nÃªn ghi láº¡i)

â UI KHÃ”NG QUAN TÃ‚M logic
UI chá»‰ nhÃ¬n STATE vÃ  váº½ â

6ï¸âƒ£ LiÃªn há»‡ trá»±c tiáº¿p vá»›i Compose (Ä‘á»ƒ báº¡n tháº¥y vÃ¬ sao bÃ i nÃ y báº¯t buá»™c)

Compose hoáº¡t Ä‘á»™ng Ä‘Ãºng theo tÆ° duy:

@Composable
fun Screen(state: MainUiState) {
    if (state.isLoading) { ... }
    Text(state.message)
}


ğŸ‘‰ KhÃ´ng cÃ³ cÃ¡ch nÃ o â€œobserve 3 thá»© rá»i ráº¡câ€ Ä‘áº¹p nhÆ° váº­y
ğŸ‘‰ UiState lÃ  Ä‘iá»u kiá»‡n báº¯t buá»™c

7ï¸âƒ£ Náº¿u nÃ³i báº±ng ngÃ´n ngá»¯ cá»§a báº¡n (tá»« cÃ¡c bÃ i trÆ°á»›c)

UiState giá»‘ng model

ViewModel lÃ  nÆ¡i duy nháº¥t sá»­a model

View chá»‰ render model

ğŸ‘‰ ÄÃ¢y má»›i lÃ  MVVM Ä‘Ãºng nghÄ©a,
khÃ´ng pháº£i â€œMVC Ä‘á»™i lá»‘t LiveDataâ€